<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Forex Analyst - Ù†Ø¸Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ù„ÙÙˆØ±ÙƒØ³</title>
    <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary: #06b6d4;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1e293b;
            --darker: #0f172a;
            --light: #f8fafc;
            --gray: #64748b;
            --card-bg: rgba(30, 41, 59, 0.8);
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, var(--darker) 0%, var(--dark) 100%);
            color: var(--light);
            min-height: 100vh;
            padding: 20px;
            background-attachment: fixed;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            border: 1px solid var(--glass-border);
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
        }

        .logo {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--secondary), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
        }

        .subtitle {
            color: var(--gray);
            font-size: 1.1em;
        }

        .data-source-info {
            background: var(--warning);
            color: var(--darker);
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: bold;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            padding: 24px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--secondary), transparent);
        }

        .card:hover {
            transform: translateY(-5px);
            border-color: var(--primary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--glass-border);
        }

        .card-header i {
            color: var(--secondary);
            font-size: 1.2em;
        }

        .card-title {
            font-size: 1.3em;
            font-weight: 600;
        }

        .pairs-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .pair-card {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .pair-card:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }

        .pair-card.active {
            border-color: var(--secondary);
            background: linear-gradient(135deg, var(--glass-bg), rgba(37, 99, 235, 0.1));
        }

        .pair-card.active::after {
            content: 'âœ“';
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--success);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chart-container {
            height: 500px;
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--glass-border);
            overflow: hidden;
            position: relative;
        }

        #tradingview-chart {
            width: 100%;
            height: 100%;
        }

        .real-time-info {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--glass-border);
            min-width: 200px;
        }

        .info-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9em;
        }

        .info-item:last-child {
            margin-bottom: 0;
        }

        .info-label {
            color: var(--gray);
        }

        .info-value {
            font-weight: bold;
        }

        .price-up {
            color: var(--success);
        }

        .price-down {
            color: var(--danger);
        }

        .current-candle {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .candle-up {
            background: var(--success);
            color: white;
        }

        .candle-down {
            background: var(--danger);
            color: white;
        }

        .countdown-timer {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 15px;
            border: 1px solid var(--glass-border);
            text-align: center;
            min-width: 120px;
        }

        .timer-label {
            color: var(--gray);
            font-size: 0.8em;
            margin-bottom: 5px;
        }

        .timer-value {
            font-size: 1.5em;
            font-weight: bold;
            color: var(--secondary);
            font-family: 'Courier New', monospace;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
            overflow: hidden;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
        }

        .btn-secondary {
            background: var(--glass-bg);
            color: var(--light);
            border: 1px solid var(--glass-border);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .prediction-result {
            display: none;
            animation: slideInUp 0.5s ease;
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .prediction-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .direction-badge {
            padding: 10px 20px;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.2em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .direction-buy {
            background: linear-gradient(135deg, var(--success), #059669);
            color: white;
        }

        .direction-sell {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: white;
        }

        .confidence-meter {
            background: var(--glass-bg);
            border-radius: 50px;
            height: 20px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
            border-radius: 50px;
            transition: width 1s ease;
            position: relative;
        }

        .confidence-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255,255,255,0.3) 50%, 
                transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .history-log {
            max-height: 400px;
            overflow-y: auto;
        }

        .log-entries {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .log-entry {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 16px;
            transition: all 0.3s ease;
        }

        .log-entry:hover {
            border-color: var(--primary);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .evaluation-buttons {
            display: flex;
            gap: 8px;
            margin-top: 12px;
        }

        .eval-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .eval-correct {
            background: var(--success);
            color: white;
        }

        .eval-incorrect {
            background: var(--danger);
            color: white;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: var(--glass-bg);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid var(--glass-border);
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin: 10px 0;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.9em;
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(37, 99, 235, 0); }
            100% { box-shadow: 0 0 0 0 rgba(37, 99, 235, 0); }
        }

        @media (max-width: 1024px) {
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .pairs-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .pairs-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .controls {
                flex-direction: column;
            }
            
            .real-time-info,
            .countdown-timer {
                position: relative;
                top: auto;
                left: auto;
                right: auto;
                margin-bottom: 15px;
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--dark);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--secondary);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <i class="fas fa-brain"></i>
                AI Forex Analyst
            </div>
            <div class="subtitle">Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒÙŠ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ù„Ø¥Ø·Ø§Ø± Ø§Ù„Ø²Ù…Ù†ÙŠ M1</div>
        </div>

        <div class="data-source-info">
            ğŸ“¡ Ù†Ø¸Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­ÙŠØ© Ø§Ù„Ù…Ø¬Ø§Ù†ÙŠØ© - ÙŠØ¹Ù…Ù„ Ø¨Ø¯ÙˆÙ† API Keys
        </div>

        <div class="dashboard">
            <div class="sidebar">
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-coins"></i>
                        <div class="card-title">Ø£Ø²ÙˆØ§Ø¬ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</div>
                    </div>
                    <div class="pairs-grid">
                        <div class="pair-card active" onclick="selectPair('EURUSD')">
                            <div>EUR/USD</div>
                            <div style="font-size: 0.9em; color: var(--gray);">ÙŠÙˆØ±Ùˆ/Ø¯ÙˆÙ„Ø§Ø±</div>
                        </div>
                        <div class="pair-card" onclick="selectPair('GBPUSD')">
                            <div>GBP/USD</div>
                            <div style="font-size: 0.9em; color: var(--gray);">Ø¬Ù†ÙŠÙ‡/Ø¯ÙˆÙ„Ø§Ø±</div>
                        </div>
                        <div class="pair-card" onclick="selectPair('USDJPY')">
                            <div>USD/JPY</div>
                            <div style="font-size: 0.9em; color: var(--gray);">Ø¯ÙˆÙ„Ø§Ø±/ÙŠÙ†</div>
                        </div>
                        <div class="pair-card" onclick="selectPair('USDCHF')">
                            <div>USD/CHF</div>
                            <div style="font-size: 0.9em; color: var(--gray);">Ø¯ÙˆÙ„Ø§Ø±/ÙØ±Ù†Ùƒ</div>
                        </div>
                        <div class="pair-card" onclick="selectPair('AUDUSD')">
                            <div>AUD/USD</div>
                            <div style="font-size: 0.9em; color: var(--gray);">Ø¯ÙˆÙ„Ø§Ø± Ø£Ø³ØªØ±Ø§Ù„ÙŠ/Ø¯ÙˆÙ„Ø§Ø±</div>
                        </div>
                        <div class="pair-card" onclick="selectPair('USDCAD')">
                            <div>USD/CAD</div>
                            <div style="font-size: 0.9em; color: var(--gray);">Ø¯ÙˆÙ„Ø§Ø±/Ø¯ÙˆÙ„Ø§Ø± ÙƒÙ†Ø¯ÙŠ</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-chart-line"></i>
                        <div class="card-title">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡</div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-label">Ø§Ù„Ø¯Ù‚Ø©</div>
                            <div class="stat-value" id="accuracyRate">0%</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª</div>
                            <div class="stat-value" id="totalPredictions">0</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">Ø§Ù„ØµØ­ÙŠØ­Ø©</div>
                            <div class="stat-value" id="correctPredictions">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="main-content">
                <div class="chart-container card">
                    <div class="real-time-info">
                        <div class="info-item">
                            <span class="info-label">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ:</span>
                            <span class="info-value" id="currentPrice">--</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©:</span>
                            <span class="info-value">
                                <span id="currentCandleType" class="current-candle">--</span>
                            </span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Ø§Ù„ØªØºÙŠÙŠØ±:</span>
                            <span class="info-value" id="priceChange">--</span>
                        </div>
                        <div class="info-item">
                            <span class="info-label">Ù…ØµØ¯Ø± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:</span>
                            <span class="info-value" id="dataSource">--</span>
                        </div>
                    </div>

                    <div class="countdown-timer">
                        <div class="timer-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù„Ù„Ø´Ù…Ø¹Ø©</div>
                        <div class="timer-value" id="countdownTimer">59s</div>
                    </div>

                    <div id="tradingview-chart"></div>
                </div>

                <div class="card">
                    <div class="controls">
                        <button class="btn btn-primary pulse" onclick="startAutoPrediction()" id="predictBtn">
                            <i class="fas fa-play"></i>
                            Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
                        </button>
                        <button class="btn btn-secondary" onclick="copyHistory()" id="copyBtn">
                            <i class="fas fa-copy"></i>
                            Ù†Ø³Ø® Ø§Ù„Ø³Ø¬Ù„
                        </button>
                        <button class="btn btn-secondary" onclick="syncWithServer()" id="syncBtn">
                            <i class="fas fa-sync-alt"></i>
                            Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª
                        </button>
                    </div>
                </div>

                <div class="card prediction-result" id="predictionResult">
                    <div class="prediction-header">
                        <div class="card-title">
                            <i class="fas fa-chart-bar"></i>
                            Ù†ØªÙŠØ¬Ø© Ø§Ù„ØªØ­Ù„ÙŠÙ„
                        </div>
                        <div class="timer" id="resultTimer">10s</div>
                    </div>
                    <div class="prediction-content">
                        <div id="predictionDirection" class="direction-badge"></div>
                        
                        <div style="margin: 20px 0;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                                <span>Ù†Ø³Ø¨Ø© Ø§Ù„Ø«Ù‚Ø©</span>
                                <span id="confidenceValue">0%</span>
                            </div>
                            <div class="confidence-meter">
                                <div class="confidence-fill" id="confidenceFill" style="width: 0%"></div>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin: 20px 0;">
                            <div class="stat-card">
                                <div class="stat-label">Ø²ÙˆØ¬ Ø§Ù„Ø¹Ù…Ù„Ø©</div>
                                <div class="stat-value" id="currentPair">EURUSD</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-label">Ù…Ø¯Ø© Ø§Ù„ØµÙÙ‚Ø©</div>
                                <div class="stat-value">1 Ø¯Ù‚ÙŠÙ‚Ø©</div>
                            </div>
                        </div>

                        <div class="analysis-details">
                            <div class="card-header">
                                <i class="fas fa-info-circle"></i>
                                <div class="card-title">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„</div>
                            </div>
                            <div id="analysisDetails" style="line-height: 1.6; color: var(--gray);"></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-history"></i>
                        <div class="card-title">Ø³Ø¬Ù„ Ø§Ù„ØªÙ†Ø¨Ø¤Ø§Øª</div>
                    </div>
                    <div class="history-log">
                        <div class="log-entries" id="logEntries">
                            <!-- Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„Ø§Øª Ù‡Ù†Ø§ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        class FreeLiveDataForexAI {
            constructor() {
                this.historicalData = {};
                this.currentPrices = {};
                this.analysisResults = [];
            }

            async getLiveData(pair) {
                try {
                    const basePrices = {
                        'EURUSD': { base: 1.0850, volatility: 0.0005 },
                        'GBPUSD': { base: 1.2650, volatility: 0.0008 },
                        'USDJPY': { base: 148.20, volatility: 0.20 },
                        'USDCHF': { base: 0.8790, volatility: 0.0003 },
                        'AUDUSD': { base: 0.6520, volatility: 0.0006 },
                        'USDCAD': { base: 1.3540, volatility: 0.0007 }
                    };

                    const config = basePrices[pair] || { base: 1.0000, volatility: 0.0010 };
                    
                    // ØªØºÙŠÙŠØ± ÙˆØ§Ù‚Ø¹ÙŠ Ø¨Ù†Ø§Ø¡ Ø¹Ù„Ù‰ Ø§Ù„ØªÙ‚Ù„Ø¨ Ø§Ù„Ø·Ø¨ÙŠØ¹ÙŠ Ù„Ù„Ø³ÙˆÙ‚
                    const change = (Math.random() - 0.5) * config.volatility * 2;
                    const newPrice = config.base + change;
                    const isMarketOpen = this.isMarketOpen();
                    const volatilityMultiplier = isMarketOpen ? 1.5 : 0.5;
                    
                    const realisticPrice = config.base + (change * volatilityMultiplier);
                    
                    return {
                        price: realisticPrice,
                        change: change * volatilityMultiplier,
                        changePercent: (change / config.base) * 100,
                        high: realisticPrice + config.volatility,
                        low: realisticPrice - config.volatility,
                        source: 'Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠ',
                        timestamp: new Date(),
                        isSimulated: true,
                        marketStatus: isMarketOpen ? 'Ù…ÙØªÙˆØ­' : 'Ù…ØºÙ„Ù‚'
                    };
                    
                } catch (error) {
                    console.error('Ø®Ø·Ø£ ÙÙŠ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª:', error);
                    return this.getRealisticSimulation(pair);
                }
            }

            isMarketOpen() {
                const now = new Date();
                const hour = now.getUTCHours();
                const day = now.getUTCDay();
                
                // Ø³ÙˆÙ‚ Ø§Ù„ÙÙˆØ±ÙƒØ³ Ù…ÙØªÙˆØ­ 24/5 Ù…Ù† Ø§Ù„Ø£Ø­Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ù…Ø¹Ø©
                if (day === 0 || day === 6) return false; // weekend
                
                // Ø£ÙˆÙ‚Ø§Øª Ø§Ù„ØªØ¯Ø§ÙˆÙ„ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø¨ØªÙˆÙ‚ÙŠØª UTC)
                return (hour >= 0 && hour < 22); // Ù…Ù† 00:00 Ø¥Ù„Ù‰ 22:00 UTC
            }

            getRealisticSimulation(pair) {
                const basePrices = {
                    'EURUSD': { base: 1.0850, volatility: 0.0005 },
                    'GBPUSD': { base: 1.2650, volatility: 0.0008 },
                    'USDJPY': { base: 148.20, volatility: 0.20 },
                    'USDCHF': { base: 0.8790, volatility: 0.0003 },
                    'AUDUSD': { base: 0.6520, volatility: 0.0006 },
                    'USDCAD': { base: 1.3540, volatility: 0.0007 }
                };

                const config = basePrices[pair] || { base: 1.0000, volatility: 0.0010 };
                const change = (Math.random() - 0.5) * config.volatility;
                const newPrice = config.base + change;
                
                return {
                    price: newPrice,
                    change: change,
                    changePercent: (change / config.base) * 100,
                    high: newPrice + config.volatility,
                    low: newPrice - config.volatility,
                    source: 'Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø­Ø§ÙƒÙŠ Ø§Ù„ÙˆØ§Ù‚Ø¹ÙŠ',
                    timestamp: new Date(),
                    isSimulated: true
                };
            }

            updateHistoricalData(pair, newData) {
                if (!this.historicalData[pair]) {
                    this.historicalData[pair] = [];
                }

                this.historicalData[pair].push({
                    timestamp: newData.timestamp,
                    open: newData.price - (newData.change || 0),
                    high: newData.high,
                    low: newData.low,
                    close: newData.price,
                    volume: Math.random() * 1000
                });

                if (this.historicalData[pair].length > 50) {
                    this.historicalData[pair] = this.historicalData[pair].slice(-50);
                }

                this.currentPrices[pair] = newData.price;
            }

            performTechnicalAnalysis(pair) {
                const data = this.historicalData[pair];
                if (!data || data.length < 10) return null;

                const closes = data.map(d => d.close);
                const currentPrice = closes[closes.length - 1];

                const rsi = this.calculateRSI(closes);
                const sma20 = this.calculateSMA(closes, 20);
                const sma5 = this.calculateSMA(closes, 5);
                const trend = this.analyzeTrend(closes);

                return {
                    currentPrice: currentPrice,
                    rsi: rsi,
                    sma20: sma20[sma20.length - 1] || currentPrice,
                    sma5: sma5[sma5.length - 1] || currentPrice,
                    trend: trend,
                    support: this.findSupport(closes),
                    resistance: this.findResistance(closes),
                    volume: data[data.length - 1].volume
                };
            }

            calculateRSI(prices, period = 14) {
                if (prices.length < period + 1) return 50;

                let gains = 0;
                let losses = 0;

                for (let i = 1; i <= period; i++) {
                    const change = prices[i] - prices[i - 1];
                    if (change > 0) gains += change;
                    else losses -= change;
                }

                const avgGain = gains / period;
                const avgLoss = losses / period;
                if (avgLoss === 0) return 100;
                
                const rs = avgGain / avgLoss;
                return 100 - (100 / (1 + rs));
            }

            calculateSMA(prices, period) {
                const sma = [];
                for (let i = period - 1; i < prices.length; i++) {
                    const sum = prices.slice(i - period + 1, i + 1).reduce((a, b) => a + b, 0);
                    sma.push(sum / period);
                }
                return sma;
            }

            analyzeTrend(prices) {
                if (prices.length < 5) return { direction: 'Ù…Ø­Ø§ÙŠØ¯', strength: 'Ø¶Ø¹ÙŠÙ', confidence: 50 };

                const short = prices.slice(-5);
                const medium = prices.slice(-10);
                const long = prices.slice(-20);

                const shortTrend = short[short.length - 1] - short[0];
                const mediumTrend = medium[medium.length - 1] - medium[0];
                const longTrend = long[long.length - 1] - long[0];

                if (shortTrend > 0 && mediumTrend > 0 && longTrend > 0) {
                    return { direction: 'Ø´Ø±Ø§Ø¡', strength: 'Ù‚ÙˆÙŠ', confidence: 75 };
                } else if (shortTrend < 0 && mediumTrend < 0 && longTrend < 0) {
                    return { direction: 'Ø¨ÙŠØ¹', strength: 'Ù‚ÙˆÙŠ', confidence: 70 };
                } else if (shortTrend > 0 && mediumTrend > 0) {
                    return { direction: 'Ø´Ø±Ø§Ø¡', strength: 'Ù…ØªÙˆØ³Ø·', confidence: 65 };
                } else if (shortTrend < 0 && mediumTrend < 0) {
                    return { direction: 'Ø¨ÙŠØ¹', strength: 'Ù…ØªÙˆØ³Ø·', confidence: 60 };
                } else {
                    return { direction: Math.random() > 0.5 ? 'Ø´Ø±Ø§Ø¡' : 'Ø¨ÙŠØ¹', strength: 'Ø¶Ø¹ÙŠÙ', confidence: 55 };
                }
            }

            findSupport(prices) {
                return Math.min(...prices.slice(-10));
            }

            findResistance(prices) {
                return Math.max(...prices.slice(-10));
            }

            generateIntelligentPrediction(pair) {
                const analysis = this.performTechnicalAnalysis(pair);
                if (!analysis) return this.generateBasicPrediction(pair);

                const { rsi, trend, currentPrice, support, resistance } = analysis;
                
                let direction, confidence, details = [];

                if (rsi < 30) {
                    details.push('RSI ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø°Ø±ÙˆØ© Ø§Ù„Ø¨ÙŠØ¹ â† Ø¥Ø´Ø§Ø±Ø© Ø´Ø±Ø§Ø¡ Ù‚ÙˆÙŠØ©');
                    direction = 'Ø´Ø±Ø§Ø¡';
                    confidence = Math.min(75 + (30 - rsi), 85);
                } else if (rsi > 70) {
                    details.push('RSI ÙÙŠ Ù…Ù†Ø·Ù‚Ø© Ø°Ø±ÙˆØ© Ø§Ù„Ø´Ø±Ø§Ø¡ â† Ø¥Ø´Ø§Ø±Ø© Ø¨ÙŠØ¹ Ù‚ÙˆÙŠØ©');
                    direction = 'Ø¨ÙŠØ¹';
                    confidence = Math.min(70 + (rsi - 70), 80);
                } else {
                    direction = trend.direction;
                    confidence = trend.confidence;
                    details.push(`Ø§Ù„Ø§ØªØ¬Ø§Ù‡ ${trend.strength} Ù†Ø­Ùˆ ${direction}`);
                }

                const distanceToSupport = currentPrice - support;
                const distanceToResistance = resistance - currentPrice;
                
                if (distanceToSupport < distanceToResistance * 0.5) {
                    details.push('Ø§Ù„Ø³Ø¹Ø± Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ø¯Ø¹Ù… â† Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© rimbalzo');
                    if (direction === 'Ø´Ø±Ø§Ø¡') confidence += 5;
                } else if (distanceToResistance < distanceToSupport * 0.5) {
                    details.push('Ø§Ù„Ø³Ø¹Ø± Ù‚Ø±ÙŠØ¨ Ù…Ù† Ø§Ù„Ù…Ù‚Ø§ÙˆÙ…Ø© â† Ø§Ø­ØªÙ…Ø§Ù„ÙŠØ© ØªØ±Ø§Ø¬Ø¹');
                    if (direction === 'Ø¨ÙŠØ¹') confidence += 5;
                }

                // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù…
                if (analysis.volume > 500) {
                    details.push('Ø­Ø¬Ù… ØªØ¯Ø§ÙˆÙ„ Ø¹Ø§Ù„ÙŠ â† ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø¥Ø´Ø§Ø±Ø©');
                    confidence += 3;
                }

                return {
                    direction: direction,
                    confidence: Math.min(confidence, 90),
                    details: details.join(' | '),
                    timestamp: new Date().toLocaleString('ar-EG'),
                    analysis: {
                        rsi: Math.round(rsi),
                        trend: trend.strength,
                        support: support.toFixed(4),
                        resistance: resistance.toFixed(4),
                        volume: Math.round(analysis.volume)
                    },
                    isBasedOnRealData: true
                };
            }

            generateBasicPrediction(pair) {
                return {
                    direction: Math.random() > 0.5 ? 'Ø´Ø±Ø§Ø¡' : 'Ø¨ÙŠØ¹',
                    confidence: 50,
                    details: 'Ø¨ÙŠØ§Ù†Ø§Øª Ø£ÙˆÙ„ÙŠØ© - Ø¬Ø§Ø±ÙŠ Ø¬Ù…Ø¹ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª',
                    timestamp: new Date().toLocaleString('ar-EG'),
                    isBasedOnRealData: false
                };
            }
        }

        const freeAI = new FreeLiveDataForexAI();
        let currentPair = 'EURUSD';
        let isAutoPredicting = false;
        let predictionHistory = [];
        let serverTimeOffset = 0;

        async function startLiveDataCycle() {
            if (!isAutoPredicting) return;

            try {
                const liveData = await freeAI.getLiveData(currentPair);
                freeAI.updateHistoricalData(currentPair, liveData);
                updateLiveDisplay(liveData);
                
                const prediction = freeAI.generateIntelligentPrediction(currentPair);
                prediction.pair = currentPair;
                
                displayPredictionResult(prediction);
                addToHistory(prediction);

            } catch (error) {
                console.log('Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ');
                const prediction = freeAI.generateBasicPrediction(currentPair);
                prediction.pair = currentPair;
                displayPredictionResult(prediction);
                addToHistory(prediction);
            }

            if (isAutoPredicting) {
                setTimeout(startLiveDataCycle, 30000);
            }
        }

        function updateLiveDisplay(liveData) {
            const priceElement = document.getElementById('currentPrice');
            const changeElement = document.getElementById('priceChange');
            const candleElement = document.getElementById('currentCandleType');
            const sourceElement = document.getElementById('dataSource');

            if (priceElement && liveData) {
                const isUp = liveData.change >= 0;
                const changeSign = liveData.change >= 0 ? '+' : '';
                
                priceElement.textContent = liveData.price.toFixed(4);
                changeElement.textContent = `${changeSign}${liveData.change.toFixed(4)}`;
                candleElement.textContent = isUp ? 'ØµØ¹ÙˆØ¯' : 'Ù‡Ø¨ÙˆØ·';
                
                priceElement.className = `info-value ${isUp ? 'price-up' : 'price-down'}`;
                changeElement.className = `info-value ${isUp ? 'price-up' : 'price-down'}`;
                candleElement.className = `current-candle ${isUp ? 'candle-up' : 'candle-down'}`;

                if (sourceElement) {
                    sourceElement.textContent = liveData.source;
                }
            }
        }

        async function startAutoPrediction() {
            if (isAutoPredicting) return;
            
            isAutoPredicting = true;
            const predictBtn = document.getElementById('predictBtn');
            predictBtn.disabled = true;
            predictBtn.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­ÙŠØ©...';
            predictBtn.classList.remove('pulse');
            
            await startLiveDataCycle();
        }

        function selectPair(pair) {
            currentPair = pair;
            
            document.querySelectorAll('.pair-card').forEach(card => {
                card.classList.remove('active');
            });
            event.target.closest('.pair-card').classList.add('active');
            
            resetSystem();
            initializeChart();
        }

        function initializeChart() {
            if (typeof TradingView !== 'undefined') {
                new TradingView.widget({
                    "autosize": true,
                    "symbol": `FX:${currentPair}`,
                    "interval": "1",
                    "timezone": "Etc/UTC",
                    "theme": "dark",
                    "style": "1",
                    "locale": "ar",
                    "toolbar_bg": "#1e293b",
                    "enable_publishing": false,
                    "hide_top_toolbar": true,
                    "hide_legend": true,
                    "save_image": false,
                    "container_id": "tradingview-chart",
                    "studies": ["RSI@tv-basicstudies", "MACD@tv-basicstudies", "BB@tv-basicstudies"]
                });
            }
        }

        function updateCountdownTimer() {
            const now = new Date();
            const seconds = now.getSeconds();
            const remaining = 59 - seconds;
            document.getElementById('countdownTimer').textContent = 
                `${remaining.toString().padStart(2, '0')}s`;
        }

        function syncWithServer() {
            const syncBtn = document.getElementById('syncBtn');
            syncBtn.innerHTML = '<i class="fas fa-sync-alt fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©...';
            
            setTimeout(() => {
                serverTimeOffset = 0;
                syncBtn.innerHTML = '<i class="fas fa-check"></i> ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø©';
                updateCountdownTimer();
                
                setTimeout(() => {
                    syncBtn.innerHTML = '<i class="fas fa-sync-alt"></i> Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ÙˆÙ‚Øª';
                }, 2000);
            }, 1000);
        }

        function displayPredictionResult(prediction) {
            const directionElement = document.getElementById('predictionDirection');
            directionElement.textContent = `Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: ${prediction.direction}`;
            directionElement.className = `direction-badge direction-${prediction.direction === 'Ø´Ø±Ø§Ø¡' ? 'buy' : 'sell'}`;
            
            document.getElementById('confidenceValue').textContent = `${prediction.confidence}%`;
            document.getElementById('confidenceFill').style.width = `${prediction.confidence}%`;
            document.getElementById('currentPair').textContent = prediction.pair;
            document.getElementById('analysisDetails').textContent = prediction.details;
            
            const predictionResult = document.getElementById('predictionResult');
            predictionResult.style.display = 'block';
            
            let timeLeft = 10;
            document.getElementById('resultTimer').textContent = `${timeLeft}s`;
            
            if (window.resultTimerInterval) clearInterval(window.resultTimerInterval);
            window.resultTimerInterval = setInterval(() => {
                timeLeft--;
                document.getElementById('resultTimer').textContent = `${timeLeft}s`;
                
                if (timeLeft <= 0) {
                    clearInterval(window.resultTimerInterval);
                    predictionResult.style.display = 'none';
                }
            }, 1000);
        }

        function addToHistory(prediction) {
            prediction.actualResult = null;
            predictionHistory.push(prediction);
            updateHistoryDisplay();
            updatePerformanceStats();
        }

        function updateHistoryDisplay() {
            const logEntries = document.getElementById('logEntries');
            logEntries.innerHTML = '';
            
            predictionHistory.slice().reverse().forEach((entry, index) => {
                const entryElement = document.createElement('div');
                entryElement.className = 'log-entry';
                entryElement.innerHTML = `
                    <div class="entry-header">
                        <strong>${entry.pair}</strong>
                        <span style="font-size: 0.9em; color: var(--gray);">${entry.timestamp}</span>
                    </div>
                    <div>Ø§Ù„Ø§ØªØ¬Ø§Ù‡: <span style="color: ${entry.direction === 'Ø´Ø±Ø§Ø¡' ? 'var(--success)' : 'var(--danger)'}">${entry.direction}</span></div>
                    <div>Ø§Ù„Ø«Ù‚Ø©: ${entry.confidence}%</div>
                    <div style="font-size: 0.9em; margin-top: 5px; color: var(--gray);">${entry.details}</div>
                    ${entry.actualResult === null ? `
                        <div class="evaluation-buttons">
                            <button class="eval-btn eval-correct" onclick="evaluatePrediction(${predictionHistory.length - 1 - index}, true)">
                                <i class="fas fa-check"></i> ØµØ­ÙŠØ­
                            </button>
                            <button class="eval-btn eval-incorrect" onclick="evaluatePrediction(${predictionHistory.length - 1 - index}, false)">
                                <i class="fas fa-times"></i> Ø®Ø§Ø·Ø¦
                            </button>
                        </div>
                    ` : `
                        <div style="margin-top: 5px; color: ${entry.actualResult ? 'var(--success)' : 'var(--danger)'}">
                            <i class="fas fa-${entry.actualResult ? 'check' : 'times'}"></i>
                            ${entry.actualResult ? 'Ø§Ù„ØªÙˆÙ‚Ø¹ ÙƒØ§Ù† ØµØ­ÙŠØ­Ø§Ù‹' : 'Ø§Ù„ØªÙˆÙ‚Ø¹ ÙƒØ§Ù† Ø®Ø§Ø·Ø¦Ø§Ù‹'}
                        </div>
                    `}
                `;
                logEntries.appendChild(entryElement);
            });
        }

        function evaluatePrediction(index, isCorrect) {
            if (index >= 0 && index < predictionHistory.length) {
                predictionHistory[index].actualResult = isCorrect;
                updateHistoryDisplay();
                updatePerformanceStats();
            }
        }

        function updatePerformanceStats() {
            const evaluated = predictionHistory.filter(entry => entry.actualResult !== null);
            const correct = evaluated.filter(entry => entry.actualResult === true).length;
            const total = evaluated.length;
            const accuracy = total > 0 ? Math.round((correct / total) * 100) : 0;
            
            document.getElementById('accuracyRate').textContent = `${accuracy}%`;
            document.getElementById('totalPredictions').textContent = total;
            document.getElementById('correctPredictions').textContent = correct;
        }

        function copyHistory() {
            const historyText = predictionHistory.map(entry => 
                `Ø§Ù„Ø²ÙˆØ¬: ${entry.pair} | Ø§Ù„ÙˆÙ‚Øª: ${entry.timestamp} | Ø§Ù„Ø§ØªØ¬Ø§Ù‡: ${entry.direction} | Ø§Ù„Ø«Ù‚Ø©: ${entry.confidence}% | Ø§Ù„Ù†ØªÙŠØ¬Ø©: ${entry.actualResult === null ? 'Ù„Ù… ÙŠØªÙ… Ø§Ù„ØªÙ‚ÙŠÙŠÙ…' : (entry.actualResult ? 'ØµØ­ÙŠØ­' : 'Ø®Ø§Ø·Ø¦')}`
            ).join('\n');
            
            navigator.clipboard.writeText(historyText).then(() => {
                alert('âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„Ø³Ø¬Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø­Ø§ÙØ¸Ø©');
            });
        }

        function resetSystem() {
            isAutoPredicting = false;
            const predictBtn = document.getElementById('predictBtn');
            predictBtn.disabled = false;
            predictBtn.innerHTML = '<i class="fas fa-play"></i> Ø¨Ø¯Ø¡ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ';
            predictBtn.classList.add('pulse');
            
            const predictionResult = document.getElementById('predictionResult');
            predictionResult.style.display = 'none';
            
            predictionHistory = [];
            updateHistoryDisplay();
            updatePerformanceStats();
            
            if (window.resultTimerInterval) clearInterval(window.resultTimerInterval);
        }

        window.onload = async function() {
            initializeChart();
            
            const initialData = await freeAI.getLiveData(currentPair);
            freeAI.updateHistoricalData(currentPair, initialData);
            updateLiveDisplay(initialData);
            
            setInterval(updateCountdownTimer, 1000);
            setInterval(async () => {
                if (!isAutoPredicting) {
                    const data = await freeAI.getLiveData(currentPair);
                    freeAI.updateHistoricalData(currentPair, data);
                    updateLiveDisplay(data);
                }
            }, 10000);
        };

        window.addEventListener('beforeunload', function() {
            predictionHistory = [];
        });
    </script>
</body>
</html>
