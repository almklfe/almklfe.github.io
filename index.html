<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø£Ø¯Ø§Ø© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© - Binance</title>
  <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      direction: rtl;
      background-color: #0f172a;
      color: #f1f5f9;
      padding: 20px;
    }
    .tool-container {
      max-width: 700px;
      margin: auto;
      background: #1e293b;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 0 25px rgba(0,0,0,0.3);
    }
    select, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      box-sizing: border-box;
    }
    select {
      background: #334155;
      color: #fff;
    }
    button {
      background-color: #3b82f6;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #2563eb;
    }
    .result, .stats {
      margin-top: 20px;
      background: #0f172a;
      padding: 15px;
      border-radius: 12px;
      border: 1px solid #475569;
    }
    .live-data {
      font-size: 14px;
      margin-top: 15px;
      background: #334155;
      padding: 10px;
      border-radius: 10px;
    }
    .status {
      margin-top: 10px;
      font-size: 14px;
    }
    .status span {
      font-weight: bold;
    }
    .correct-wrong-btns button {
      margin-top: 10px;
      width: 49%;
    }
    #chart {
      height: 300px;
      margin-top: 20px;
    }
    .confidence-bar {
      height: 10px;
      background: #334155;
      border-radius: 5px;
      margin-top: 5px;
      overflow: hidden;
    }
    .confidence-level {
      height: 100%;
      background: linear-gradient(90deg, #ef4444, #3b82f6, #10b981);
      transition: width 0.5s;
    }
    .advanced-info {
      margin-top: 10px;
      padding: 10px;
      background: #1e293b;
      border-radius: 8px;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="tool-container">
    <h2>ğŸ“Š Ø£Ø¯Ø§Ø© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h2>

    <div id="chart"></div>

    <label for="pair">ğŸ”½ Ø§Ø®ØªØ± Ø²ÙˆØ¬ Ø§Ù„Ø¹Ù…Ù„Ø©:</label>
    <select id="pair">
      <option value="btcusdt">BTC/USDT</option>
      <option value="ethusdt">ETH/USDT</option>
      <option value="bnbusdt">BNB/USDT</option>
      <option value="solusdt">SOL/USDT</option>
      <option value="xrpusdt">XRP/USDT</option>
      <option value="adausdt">ADA/USDT</option>
      <option value="dogeusdt">DOGE/USDT</option>
      <option value="dotusdt">DOT/USDT</option>
    </select>

    <button onclick="analyzeCandle()">ğŸ” ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©</button>

    <div class="status" id="connectionStatus">ğŸ”Œ Ø§Ù„Ø­Ø§Ù„Ø©: <span>Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„...</span></div>
    <div class="live-data" id="liveData">ğŸ“¡ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†...</div>
    <div class="result" id="result" style="display:none;"></div>

    <div class="correct-wrong-btns">
      <button onclick="recordStat(true)" style="background-color: #10b981;">âœ… Ø§Ù„ØªÙˆÙ‚Ø¹ ÙƒØ§Ù† ØµØ­ÙŠØ­</button>
      <button onclick="recordStat(false)" style="background-color: #ef4444;">âŒ Ø§Ù„ØªÙˆÙ‚Ø¹ ÙƒØ§Ù† Ø®Ø§Ø·Ø¦</button>
    </div>

    <div class="stats" id="statsBox">
      <h4>ğŸ“ˆ Ø¥Ø­ØµØ§Ø¦ÙŠØ§ØªÙƒ:</h4>
      <p>âœ… ØµØ­ÙŠØ­Ø©: <span id="correctCount">0</span></p>
      <p>âŒ Ø®Ø§Ø·Ø¦Ø©: <span id="wrongCount">0</span></p>
      <p>ğŸ“Š Ù†Ø³Ø¨Ø© Ø§Ù„Ù†Ø¬Ø§Ø­: <span id="accuracy">0</span>%</p>
      <p>ğŸ“… Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«: <span id="lastUpdate">-</span></p>
    </div>
  </div>

  <script>
    let socket, chart, candleSeries, last5Candles = [];
    let latestCandle, lastPrediction;
    const connStatus = document.getElementById("connectionStatus").querySelector("span");
    const liveDataBox = document.getElementById("liveData");

    function initChart() {
      chart = LightweightCharts.createChart(document.getElementById("chart"), {
        layout: { backgroundColor: '#0f172a', textColor: '#f8fafc' },
        grid: { vertLines: { color: '#334155' }, horzLines: { color: '#334155' } },
        timeScale: { timeVisible: true, secondsVisible: false },
      });
      candleSeries = chart.addCandlestickSeries();
    }

    function connectWebSocket(pair) {
      if (socket) socket.close();
      const url = `wss://stream.binance.com:9443/ws/${pair}@kline_5m`;
      socket = new WebSocket(url);

      socket.onopen = () => {
        connStatus.textContent = "ğŸŸ¢ Ù…ØªØµÙ„";
        connStatus.style.color = "#10b981";
        liveDataBox.innerHTML = "â³ Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©...";
      };

      socket.onclose = () => {
        connStatus.textContent = "ğŸ”´ ØºÙŠØ± Ù…ØªØµÙ„";
        connStatus.style.color = "#ef4444";
        setTimeout(() => connectWebSocket(pair), 5000); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†
      };

      socket.onmessage = function (event) {
        const data = JSON.parse(event.data);
        if (data.k) {
          const k = data.k;
          latestCandle = k;

          const bar = {
            time: k.t / 1000,
            open: parseFloat(k.o),
            high: parseFloat(k.h),
            low: parseFloat(k.l),
            close: parseFloat(k.c),
          };
          
          candleSeries.update(bar);
          
          // ØªØ®Ø²ÙŠÙ† Ø¢Ø®Ø± 5 Ø´Ù…ÙˆØ¹ Ù„Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…
          if (k.x) { // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø´Ù…Ø¹Ø© Ù…ØºÙ„Ù‚Ø©
            last5Candles.push(bar);
            if (last5Candles.length > 5) last5Candles.shift();
          }

          if (!k.x) {
            liveDataBox.innerHTML = `
              ğŸ•’ Ø§Ù„ÙˆÙ‚Øª: ${new Date().toLocaleTimeString()} | ${new Date(k.t).toLocaleTimeString()}<br>
              ğŸ“ˆ Ø§Ù„Ø¥ØºÙ„Ø§Ù‚: ${bar.close.toFixed(4)} | ğŸ“‰ Ø§Ù„Ø§ÙØªØªØ§Ø­: ${bar.open.toFixed(4)}<br>
              ğŸ”¼ Ø§Ù„Ø£Ø¹Ù„Ù‰: ${bar.high.toFixed(4)} | ğŸ”½ Ø§Ù„Ø£Ø¯Ù†Ù‰: ${bar.low.toFixed(4)}<br>
              ğŸ” Ø§Ù„Ø­Ø¬Ù…: ${parseFloat(k.v).toFixed(2)} | ğŸ’° Ø§Ù„Ù‚ÙŠÙ…Ø©: ${(parseFloat(k.v) * parseFloat(k.c)).toFixed(2)} USDT
            `;
          }
        }
      };
    }

    function analyzeCandle() {
      const resultBox = document.getElementById("result");
      resultBox.style.display = "block";
      
      if (!latestCandle) {
        resultBox.innerHTML = "âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø­ÙŠØ© Ø­Ø§Ù„ÙŠØ§Ù‹. Ø§Ù†ØªØ¸Ø± Ù‚Ù„ÙŠÙ„Ø§Ù‹ Ø«Ù… Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
        return;
      }

      const open = parseFloat(latestCandle.o);
      const close = parseFloat(latestCandle.c);
      const high = parseFloat(latestCandle.h);
      const low = parseFloat(latestCandle.l);
      const volume = parseFloat(latestCandle.v);
      const isBullish = close > open;
      const body = Math.abs(close - open);
      const candleSize = high - low;
      const bodyRatio = candleSize > 0 ? (body / candleSize) : 0;

      // 1. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      let direction = isBullish ? "Ø´Ø±Ø§Ø¡" : "Ø¨ÙŠØ¹";
      let confidence = 50;
      let reasons = [];
      let advancedInfo = [];

      // ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      if (bodyRatio > 0.7) {
        confidence += 30;
        reasons.push("Ø¬Ø³Ù… Ø´Ù…Ø¹Ø© ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø²Ø®Ù… Ù‚ÙˆÙŠ");
      } else if (bodyRatio > 0.4) {
        confidence += 15;
        reasons.push("Ø¬Ø³Ù… Ø´Ù…Ø¹Ø© ÙˆØ§Ø¶Ø­ ÙŠØ¯Ø¹Ù… Ø§Ù„Ø§ØªØ¬Ø§Ù‡");
      } else if (bodyRatio > 0.1) {
        confidence += 5;
        reasons.push("Ø¬Ø³Ù… Ø´Ù…Ø¹Ø© ØµØºÙŠØ± Ù…Ø¹ ØªØ±Ø¯Ø¯ ÙÙŠ Ø§Ù„Ø³ÙˆÙ‚");
      } else {
        confidence -= 10;
        reasons.push("Ø´Ù…Ø¹Ø© Ø¯ÙˆØ¬ÙŠ ØªØ´ÙŠØ± Ø¥Ù„Ù‰ ØªØ±Ø¯Ø¯ Ø´Ø¯ÙŠØ¯");
      }

      // 2. ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø­Ø¬Ù…
      const avgVolume = last5Candles.reduce((sum, candle) => sum + (candle.high - candle.low), 0) / last5Candles.length;
      const volumeRatio = avgVolume > 0 ? candleSize / avgVolume : 1;
      
      if (volumeRatio > 1.5) {
        confidence += 10;
        reasons.push("Ø­Ø¬Ù… ØªØ¯Ø§ÙˆÙ„ Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ù…ØªÙˆØ³Ø· ÙŠØ¯Ø¹Ù… Ø§Ù„Ø­Ø±ÙƒØ©");
      } else if (volumeRatio < 0.7) {
        confidence -= 10;
        reasons.push("Ø­Ø¬Ù… ØªØ¯Ø§ÙˆÙ„ Ù…Ù†Ø®ÙØ¶ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø¶Ø¹Ù Ø§Ù„Ø­Ø±ÙƒØ©");
      }

      // 3. ØªØ­Ù„ÙŠÙ„ Ø¢Ø®Ø± 5 Ø´Ù…ÙˆØ¹
      if (last5Candles.length >= 3) {
        const prevTrend = last5Candles.slice(-3).reduce((sum, candle) => sum + (candle.close > candle.open ? 1 : -1), 0);
        
        if (Math.abs(prevTrend) >= 2) {
          const isConsistent = (prevTrend > 0 && isBullish) || (prevTrend < 0 && !isBullish);
          if (isConsistent) {
            confidence += 10;
            reasons.push("Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…ØªØ³Ù‚ Ù…Ø¹ Ø§Ù„Ø­Ø±ÙƒØ© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©");
          } else {
            confidence -= 5;
            reasons.push("ØªÙ†Ø§Ù‚Ø¶ Ù…Ø¹ Ø§Ù„Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø³Ø§Ø¨Ù‚ ÙŠØ­Ø°Ø± Ù…Ù† Ø§Ù†Ø¹ÙƒØ§Ø³ Ù…Ø­ØªÙ…Ù„");
          }
        }
      }

      // 4. Ø¶Ø¨Ø· Ø§Ù„Ø«Ù‚Ø© ÙÙŠ Ø§Ù„Ø­Ø¯ÙˆØ¯ Ø§Ù„Ù…Ù†Ø·Ù‚ÙŠØ©
      confidence = Math.max(30, Math.min(90, confidence));
      
      // 5. ØªØ­Ù„ÙŠÙ„ Ø¸Ù„Ø§Ù„ Ø§Ù„Ø´Ù…Ø¹Ø©
      const upperShadow = high - (isBullish ? close : open);
      const lowerShadow = (isBullish ? open : close) - low;
      
      if (upperShadow > body * 2 && lowerShadow > body * 2) {
        confidence -= 15;
        reasons.push("Ø¸Ù„Ø§Ù„ Ø·ÙˆÙŠÙ„Ø© Ù…Ù† ÙƒÙ„Ø§ Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠÙ† ØªØ´ÙŠØ± Ø¥Ù„Ù‰ ØµØ±Ø§Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ù…Ø´ØªØ±ÙŠÙ† ÙˆØ§Ù„Ø¨Ø§Ø¦Ø¹ÙŠÙ†");
      } else if (upperShadow > body * 1.5) {
        confidence -= 8;
        reasons.push("Ø¸Ù„ Ø¹Ù„ÙˆÙŠ Ø·ÙˆÙŠÙ„ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ù…Ù‚Ø§ÙˆÙ…Ø©");
      } else if (lowerShadow > body * 1.5) {
        confidence -= 8;
        reasons.push("Ø¸Ù„ Ø³ÙÙ„ÙŠ Ø·ÙˆÙŠÙ„ ÙŠØ´ÙŠØ± Ø¥Ù„Ù‰ Ø¯Ø¹Ù…");
      }

      // Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„Ø¥Ø¸Ù‡Ø§Ø±
      advancedInfo.push(`Ù†Ø³Ø¨Ø© Ø§Ù„Ø¬Ø³Ù…/Ø§Ù„Ø­Ø¬Ù…: ${(bodyRatio*100).toFixed(1)}%`);
      advancedInfo.push(`Ù†Ø³Ø¨Ø© Ø§Ù„Ø­Ø¬Ù…: ${volumeRatio.toFixed(2)}x Ù…Ù† Ø§Ù„Ù…ØªÙˆØ³Ø·`);
      if (last5Candles.length >= 3) {
        const priceChange = ((close - last5Candles[0].close) / last5Candles[0].close * 100).toFixed(2);
        advancedInfo.push(`Ø§Ù„ØªØºÙŠØ± ÙÙŠ Ø¢Ø®Ø± 3 Ø´Ù…ÙˆØ¹: ${priceChange}%`);
      }

      // Ø­ÙØ¸ Ø§Ù„ØªÙ†Ø¨Ø¤ Ø§Ù„Ø£Ø®ÙŠØ± Ù„Ù…Ù‚Ø§Ø±Ù†ØªÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
      lastPrediction = {
        direction,
        confidence,
        time: new Date().toLocaleTimeString(),
        actual: null
      };

      // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      resultBox.innerHTML = `
        <strong>ğŸ”® Ø§Ù„ØªÙ†Ø¨Ø¤ Ø¨Ø§Ù„Ø´Ù…Ø¹Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©:</strong> <span style="color:${isBullish ? '#10b981' : '#ef4444'}">${direction}</span><br>
        <strong>ğŸ“Š Ù†Ø³Ø¨Ø© Ø§Ù„Ø«Ù‚Ø©:</strong> ${confidence}%
        <div class="confidence-bar"><div class="confidence-level" style="width:${confidence}%"></div></div>
        <strong>ğŸ“Œ Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨:</strong><br>
        <ul style="margin-top:5px;padding-right:15px;">${reasons.map(r => `<li>${r}</li>`).join('')}</ul>
        <div class="advanced-info">
          <strong>ğŸ“Š Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ù…ØªÙ‚Ø¯Ù…Ø©:</strong><br>
          ${advancedInfo.join(' | ')}
        </div>
      `;
    }

    function recordStat(correct) {
      let correctCount = parseInt(localStorage.getItem("correct") || "0");
      let wrongCount = parseInt(localStorage.getItem("wrong") || "0");

      if (correct) correctCount++;
      else wrongCount++;

      localStorage.setItem("correct", correctCount);
      localStorage.setItem("wrong", wrongCount);
      
      // Ø­ÙØ¸ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„ÙØ¹Ù„ÙŠØ© Ù„Ù„ØªÙ†Ø¨Ø¤ Ø§Ù„Ø£Ø®ÙŠØ±
      if (lastPrediction) {
        lastPrediction.actual = correct;
        savePredictionHistory(lastPrediction);
      }
      
      updateStats();
    }

    function savePredictionHistory(prediction) {
      const history = JSON.parse(localStorage.getItem("predictionHistory") || []);
      history.push(prediction);
      if (history.length > 50) history.shift(); // Ø­ÙØ¸ Ø¢Ø®Ø± 50 ØªÙ†Ø¨Ø¤ ÙÙ‚Ø·
      localStorage.setItem("predictionHistory", JSON.stringify(history));
    }

    function updateStats() {
      const correct = parseInt(localStorage.getItem("correct") || "0");
      const wrong = parseInt(localStorage.getItem("wrong") || "0");
      const total = correct + wrong;
      const accuracy = total > 0 ? ((correct / total) * 100).toFixed(1) : 0;

      document.getElementById("correctCount").textContent = correct;
      document.getElementById("wrongCount").textContent = wrong;
      document.getElementById("accuracy").textContent = accuracy;
      document.getElementById("lastUpdate").textContent = new Date().toLocaleTimeString();
    }

    document.getElementById("pair").addEventListener("change", function () {
      last5Candles = [];
      latestCandle = null;
      initChart();
      connectWebSocket(this.value);
    });

    // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
    initChart();
    connectWebSocket(document.getElementById("pair").value);
    updateStats();
  </script>
</body>
</html>
