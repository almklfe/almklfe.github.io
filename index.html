<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>أداة توقع الشمعة القادمة</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script type="text/javascript" src="https://s3.tradingview.com/tv.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gradient-to-b from-gray-100 to-white min-h-screen p-6">
  <div class="max-w-4xl mx-auto bg-white shadow-xl rounded-2xl p-8">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-6">🔮 أداة احترافية لتوقع الشمعة القادمة (5 دقائق)</h1><div class="grid grid-cols-1 md:grid-cols-2 gap-6">
  <div>
    <label class="block font-semibold mb-1 text-gray-700">اختر زوج العملة:</label>
    <select id="pair" class="w-full p-3 border rounded-xl shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
      <option value="btcusdt">BTC/USDT</option>
      <option value="ethusdt">ETH/USDT</option>
      <option value="bnbusdt">BNB/USDT</option>
    </select>
    <button onclick="analyze()" class="mt-4 w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-xl font-semibold transition-all">🔍 تحليل الآن</button>

    <div id="result" class="mt-6 hidden border-t pt-4">
      <h2 class="text-xl font-semibold text-gray-700 mb-2">📊 نتيجة التوقع:</h2>
      <p class="text-lg"><strong>الشمعة التالية:</strong> <span id="direction" class="font-bold text-blue-700"></span></p>
      <p class="text-lg"><strong>نسبة الثقة:</strong> <span id="confidence" class="text-green-600"></span>%</p>
      <p class="text-sm mt-2 text-gray-600"><strong>السبب:</strong> <span id="reason"></span></p>
    </div>
  </div>

  <div>
    <div class="rounded-xl overflow-hidden border">
      <div id="tv-chart" class="h-[400px] w-full"></div>
    </div>
  </div>
</div>

<p class="text-xs text-gray-400 mt-8 text-center">⚠️ هذه الأداة تقدم تحليل فني باستخدام بيانات حية من Binance. ليست نصيحة مالية.</p>

  </div>  <script>
    function loadChart(pair) {
      new TradingView.widget({
        container_id: "tv-chart",
        autosize: true,
        symbol: `BINANCE:${pair.toUpperCase()}`,
        interval: "5",
        timezone: "Etc/UTC",
        theme: "light",
        style: "1",
        locale: "ar",
        enable_publishing: false,
        allow_symbol_change: true,
        hide_top_toolbar: true,
        hide_legend: false,
        save_image: false
      });
    }

    async function analyze() {
      const pair = document.getElementById("pair").value;
      loadChart(pair);
      const limit = 100;

      try {
        const response = await fetch(`https://api.binance.com/api/v3/klines?symbol=${pair.toUpperCase()}&interval=5m&limit=${limit}`);
        const data = await response.json();

        const closes = data.map(d => parseFloat(d[4]));
        const highs = data.map(d => parseFloat(d[2]));
        const lows = data.map(d => parseFloat(d[3]));

        let gains = 0, losses = 0;
        for (let i = 1; i < closes.length; i++) {
          const change = closes[i] - closes[i - 1];
          if (change > 0) gains += change;
          else losses -= change;
        }
        const avgGain = gains / (closes.length - 1);
        const avgLoss = losses / (closes.length - 1);
        const rs = avgGain / avgLoss;
        const rsi = 100 - (100 / (1 + rs));

        const smaFast = closes.slice(-5).reduce((a, b) => a + b) / 5;
        const smaSlow = closes.slice(-20).reduce((a, b) => a + b) / 20;

        const lastClose = closes[closes.length - 1];
        const highestHigh = Math.max(...highs.slice(-14));
        const lowestLow = Math.min(...lows.slice(-14));
        const stochastic = ((lastClose - lowestLow) / (highestHigh - lowestLow)) * 100;

        const ema = (arr, period) => {
          const k = 2 / (period + 1);
          let emaArr = [arr.slice(0, period).reduce((a, b) => a + b) / period];
          for (let i = period; i < arr.length; i++) {
            emaArr.push(arr[i] * k + emaArr[emaArr.length - 1] * (1 - k));
          }
          return emaArr;
        };
        const macdLine = ema(closes, 12).slice(-1)[0] - ema(closes, 26).slice(-1)[0];

        let direction, confidence, reasons = [];

        if (rsi < 30 && stochastic < 20 && macdLine > 0 && smaFast > smaSlow) {
          direction = "شراء (LONG)";
          confidence = 90;
          reasons.push("RSI منخفض (تشبع بيعي)");
          reasons.push("Stochastic منخفض (تشبع بيعي)");
          reasons.push("MACD إيجابي");
          reasons.push("SMA يشير لصعود");
        } else if (rsi > 70 && stochastic > 80 && macdLine < 0 && smaFast < smaSlow) {
          direction = "بيع (SHORT)";
          confidence = 90;
          reasons.push("RSI مرتفع (تشبع شرائي)");
          reasons.push("Stochastic مرتفع (تشبع شرائي)");
          reasons.push("MACD سلبي");
          reasons.push("SMA يشير لهبوط");
        } else if (macdLine > 0 && smaFast > smaSlow) {
          direction = "شراء (LONG)";
          confidence = 75;
          reasons.push("MACD إيجابي");
          reasons.push("الاتجاه العام صاعد");
        } else if (macdLine < 0 && smaFast < smaSlow) {
          direction = "بيع (SHORT)";
          confidence = 75;
          reasons.push("MACD سلبي");
          reasons.push("الاتجاه العام هابط");
        } else {
          direction = "محايد";
          confidence = 50;
          reasons.push("لا توجد إشارات واضحة حالياً");
        }

        document.getElementById("direction").textContent = direction;
        document.getElementById("confidence").textContent = confidence;
        document.getElementById("reason").textContent = reasons.join("؛ ");
        document.getElementById("result").classList.remove("hidden");

      } catch (error) {
        alert("فشل في جلب البيانات من Binance. الرجاء المحاولة مرة أخرى.");
        console.error(error);
      }
    }
  </script></body>
</html>
