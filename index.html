<!DOCTYPE html><html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>أداة التنبؤ بالشمعة القادمة - Binance</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      direction: rtl;
      background-color: #0f172a;
      color: #f1f5f9;
      padding: 20px;
    }
    .tool-container {
      max-width: 600px;
      margin: auto;
      background: #1e293b;
      padding: 25px;
      border-radius: 16px;
      box-shadow: 0 0 25px rgba(0,0,0,0.3);
    }
    select, button {
      width: 100%;
      padding: 12px;
      margin-top: 10px;
      font-size: 16px;
      border-radius: 10px;
      border: none;
      box-sizing: border-box;
    }
    select {
      background: #334155;
      color: #fff;
    }
    button {
      background-color: #3b82f6;
      color: white;
      cursor: pointer;
      transition: 0.3s;
    }
    button:hover {
      background-color: #2563eb;
    }
    .result, .stats {
      margin-top: 20px;
      background: #0f172a;
      padding: 15px;
      border-radius: 12px;
      border: 1px solid #475569;
    }
    .live-data {
      font-size: 14px;
      margin-top: 15px;
      background: #334155;
      padding: 10px;
      border-radius: 10px;
    }
    .status {
      margin-top: 10px;
      font-size: 14px;
    }
    .status span {
      font-weight: bold;
    }
    .correct-wrong-btns button {
      margin-top: 10px;
      width: 49%;
    }
  </style>
</head>
<body>
  <div class="tool-container">
    <h2>📊 أداة التنبؤ باتجاه الشمعة القادمة</h2><label for="pair">🔽 اختر زوج العملة:</label>
<select id="pair">
  <option value="btcusdt">BTC/USDT</option>
  <option value="ethusdt">ETH/USDT</option>
  <option value="bnbusdt">BNB/USDT</option>
  <option value="solusdt">SOL/USDT</option>
  <option value="xrpusdt">XRP/USDT</option>
</select>

<button onclick="analyzeCandle()">🔍 تحليل الشمعة</button>

<div class="status" id="connectionStatus">🔌 الحالة: <span>جاري الاتصال...</span></div>
<div class="live-data" id="liveData">📡 لا توجد بيانات حتى الآن...</div>
<div class="result" id="result" style="display:none;"></div>

<div class="correct-wrong-btns">
  <button onclick="recordStat(true)" style="background-color: #10b981;">✅ التوقع كان صحيح</button>
  <button onclick="recordStat(false)" style="background-color: #ef4444;">❌ التوقع كان خاطئ</button>
</div>

<div class="stats" id="statsBox">
  <h4>📈 إحصائياتك:</h4>
  <p>✅ صحيحة: <span id="correctCount">0</span></p>
  <p>❌ خاطئة: <span id="wrongCount">0</span></p>
  <p>📊 نسبة النجاح: <span id="accuracy">0</span>%</p>
</div>

  </div>  <script>
    let socket;
    let latestCandle;
    const connStatus = document.getElementById("connectionStatus").querySelector("span");
    const liveDataBox = document.getElementById("liveData");

    function connectWebSocket(pair) {
      if (socket) socket.close();
      const url = `wss://stream.binance.com:9443/ws/${pair}@kline_5m`;
      socket = new WebSocket(url);

      socket.onopen = () => {
        connStatus.textContent = "🟢 متصل";
        connStatus.style.color = "#10b981";
      };

      socket.onclose = () => {
        connStatus.textContent = "🔴 غير متصل";
        connStatus.style.color = "#ef4444";
      };

      socket.onmessage = function (event) {
        const data = JSON.parse(event.data);
        if (data.k && !data.k.x) {
          latestCandle = data.k;
          const { o, c, h, l, v } = data.k;
          liveDataBox.innerHTML = `
            🕒 الوقت: ${new Date().toLocaleTimeString()}<br>
            📈 الإغلاق: ${parseFloat(c)}<br>
            📉 الافتتاح: ${parseFloat(o)}<br>
            🔼 الأعلى: ${parseFloat(h)}<br>
            🔽 الأدنى: ${parseFloat(l)}<br>
            🔁 الحجم: ${parseFloat(v).toFixed(2)}
          `;
        }
      };
    }

    function analyzeCandle() {
      const resultBox = document.getElementById("result");
      resultBox.style.display = "block";
      if (!latestCandle) {
        resultBox.innerHTML = "⚠️ لا توجد بيانات حية حالياً. انتظر قليلاً ثم حاول مرة أخرى.";
        return;
      }

      const open = parseFloat(latestCandle.o);
      const close = parseFloat(latestCandle.c);
      const high = parseFloat(latestCandle.h);
      const low = parseFloat(latestCandle.l);
      const volume = parseFloat(latestCandle.v);

      let direction = "شراء";
      let confidence = 50;
      let reason = "";

      const body = Math.abs(close - open);
      const candleSize = high - low;
      const upperWick = high - Math.max(open, close);
      const lowerWick = Math.min(open, close) - low;

      if (close < open) {
        direction = "بيع";
      }

      if (body / candleSize > 0.6) {
        confidence = 85;
        reason = "جسم شمعة كبير وزخم قوي في الاتجاه الحالي.";
      } else if (body / candleSize > 0.3) {
        confidence = 70;
        reason = "شمعة متوسطة تشير إلى احتمال استمرار الاتجاه.";
      } else {
        confidence = 55;
        reason = "شمعة ضعيفة مع تذبذب، احتمال انعكاس أو تردد في السوق.";
      }

      resultBox.innerHTML = `
        <strong>🔮 الشمعة التالية:</strong> ${direction}<br>
        <strong>📊 نسبة الثقة:</strong> ${confidence}%<br>
        <strong>📌 السبب:</strong> ${reason}
      `;
    }

    function recordStat(correct) {
      let correctCount = parseInt(localStorage.getItem("correct") || "0");
      let wrongCount = parseInt(localStorage.getItem("wrong") || "0");

      if (correct) correctCount++;
      else wrongCount++;

      localStorage.setItem("correct", correctCount);
      localStorage.setItem("wrong", wrongCount);
      updateStats();
    }

    function updateStats() {
      const correct = parseInt(localStorage.getItem("correct") || "0");
      const wrong = parseInt(localStorage.getItem("wrong") || "0");
      const total = correct + wrong;
      const accuracy = total > 0 ? ((correct / total) * 100).toFixed(1) : 0;

      document.getElementById("correctCount").textContent = correct;
      document.getElementById("wrongCount").textContent = wrong;
      document.getElementById("accuracy").textContent = accuracy;
    }

    document.getElementById("pair").addEventListener("change", function () {
      latestCandle = null;
      connectWebSocket(this.value);
    });

    connectWebSocket(document.getElementById("pair").value);
    updateStats();
  </script></body>
</html>
